"../libs/sdl" library import

-1 !autogc # turn off major GC

:randd rand 10000 % 5000 - 1500.0 / ;
:randc [] 0 3 range each {rand 128 % 128+,};

:mkthingy |:self| 
    [% dup!self
     `x 395,
     `y 395,
     `dx randd,
     `dy randd,
     `col randc,
     `move (|:x,y|
         ?self?`x ?self?`dx + !x
         ?self?`y ?self?`dy + !y
         ?x ?Width > ?x 0 < or if
             ?self?`dx neg ?self!`dx
         then
         ?y ?Height > ?y 0 < or if
             ?self?`dy neg ?self!`dy
         then
         ?x ?self!`x
         ?y ?self!`y
     ),
     `draw (
         ?self?`col each{i} col
         ?self?`x ?self?`y 10 10 fillrect
     )
     ]
;


(
    |x:| "key down " ?x + .
    ?x 113 = if done then
) onkeydown

(
    scr width 10 - !Width 
    scr height 10 - !Height
    clear
    ?Thingies each { i?`move@ i?`draw@ }
    flip
) ondraw

[] 0 10000 range each {mkthingy,} !Thingies
-1 -1  fullscreenopen loop close quit
