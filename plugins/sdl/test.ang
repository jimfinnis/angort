"../libs/sdl" library import

:randd rand 10000 % 5000 - 1500.0 / dup.;
:randc [] 0 3 range each {rand 128 % 128+,};

:mkthingy |:self| [% dup!self
 `x 395,
 `y 395,
 `dx randd,
 `dy randd,
 `col randc,
 `move (|:x,y|
     ?self?`x ?self?`dx + !x
     ?x 790 > ?x 0 < or if
         ?self?`dx neg ?self!`dx
     then
     ?self?`y ?self?`dy + !y
     ?y 790 > ?y 0 < or if
         ?self?`dy neg ?self!`dy
     then
     ?x ?self!`x
     ?y ?self!`y
 ),
 `draw (
     ?self?`col each{i} col
     ?self?`x ?self?`y 10 10 fillrect
 )
 ]
;


(
    |x:| "key down " ?x + .
    ?x 113 = if done then
) onkeydown

(
    clear
    ?Thingies each { i?`move@ i?`draw@ }
    flip
) ondraw

[] 0 500 range each {mkthingy,} !Thingies
800 800 open loop close quit
